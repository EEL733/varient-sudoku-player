/*! @license pzpr.js v85a6346 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["lookouts"],{MouseEvent:{autoplay_func:"border",inputModes:{edit:["number","empty","clear"],play:["border","subline"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mouseinputAutoPlay(),this.notInputted()&&this.mousestart&&this.inputqcmp()):this.puzzle.editmode&&(this.mousestart&&this.inputqnum(),this.mousestart&&this.getbank()&&("left"===this.btn?this.inputpiece():this.inputqcmp()))},inputpiece:function(){var e,t=this.getbank();t&&null!==t.index&&(e=this.cursor.getaddr(),this.cursor.bankpiece=t.index,e.draw())},inputqcmp:function(){var e=this.getbank();e&&(e.setQcmp(e.qcmp?0:1),e.draw())}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(e){if(this.puzzle.playmode)return this.moveTCell(e);var t=this.cursor;if(null!==t.bankpiece){var i=this.cursor.getaddr(),n=!1,r=this.board.bank.pieces[t.bankpiece]||this.board.bank.addButton;switch(e){case"left":0<t.bankpiece&&(t.bankpiece--,n=!0);break;case"right":t.bankpiece<this.board.bank.pieces.length&&(t.bankpiece++,n=!0);break;case"up":var s,n=0===r.y?(t.bankpiece=null,s=(r.x+r.w/2)/(this.board.bank.width||1)*this.board.cols*2|1,t.bx=Math.max(t.minx,Math.min(s,t.maxx)),t.by=t.maxy,!0):this.moveBankVertical(-1);break;case"down":n=this.moveBankVertical(1)}return i.draw(),n}if("down"!==e||t.by!==t.maxy)return this.moveTCell(e);i=this.cursor.getaddr();if(t.bx===t.minx)t.bankpiece=0;else for(var o=t.bx/this.puzzle.painter.bankratio,a=0;;){if(!(r=this.board.bank.pieces[a])){t.bankpiece=this.board.bank.pieces.length;break}if(r.x<=o&&r.x+r.w>=o){t.bankpiece=a;break}if(0<r.y){t.bankpiece=a-1;break}a++}return i.draw(),!0},moveBankVertical:function(e){for(var t=this.cursor,i=this.board.bank.pieces[t.bankpiece]||this.board.bank.addButton,n=i.x+i.w/2,r=t.bankpiece+e;0<=r&&r<=this.board.bank.pieces.length;r+=e)if((i=this.board.bank.pieces[r]||this.board.bank.addButton).x<=n&&i.x+i.w>=n)return t.bankpiece=r,!0;return!1},keyinput:function(e){if(null!==this.cursor.bankpiece&&this.puzzle.editmode){var t=this.board.bank.pieces[this.cursor.bankpiece]||this.board.bank.addButton;if(("BS"===e||" "===e)&&-1===t.getNum())return t!==this.board.bank.addButton&&this.board.bank.setPiece(null,this.cursor.bankpiece),"BS"===e&&0<this.cursor.bankpiece&&this.cursor.bankpiece--,void t.draw();var i=this.getNewNumber(t,e,t.getNum());null!==i&&(t.setNum(i),(t=this.board.bank.pieces[this.cursor.bankpiece]).draw(),this.prev=t,this.cancelDefault=!0)}else this.key_inputqnum(e)}},Cell:{disableAnum:!0,minnum:function(){return this.puzzle.playmode?1:0},maxnum:function(){return this.puzzle.playmode?Math.max(1,this.board.bank.highestPiece):Math.min(999,this.board.rows*this.board.cols)},enableSubNumberArray:!0,allowShade:function(){return 0===this.qnum||-1===this.qnum},allowUnshade:function(){return 0!==this.qnum},getViewCells:function(e,t,i){for(var n=0,r=this.relcell(t,i);r&&r.isValid()&&r.room.id===e;)n++,r=r.relcell(t,i);return n}},Board:{hasborder:1,getBankPiecesInGrid:function(){for(var e=[],t=(this.ublkmgr.enabled?this.ublkmgr:this.roommgr).components,i=0;i<t.length;i++){var n=t[i].clist;e.push([n.length+"",n])}return e}},Border:{isQuesBorder:function(){return this.sidecell[0].isEmpty()||this.sidecell[1].isEmpty()},prehook:{qans:function(){return this.isQuesBorder()},qsub:function(){return this.isQuesBorder()}}},AreaRoomGraph:{enabled:!0},Bank:{enabled:!0,allowAdd:!0,defaultPreset:function(){return this.presets[0].constant},presets:[{name:"preset.nine",createOnly:!0,shortkey:"i",constant:["1","2","3","4","5","6","7","8","9"]},{name:"preset.range",func:"generateRange",field:{type:"number",value:9,min:0,max:999,size:4}},{name:"preset.copy_answer",func:"copyAnswer"},{name:"preset.zero",shortkey:"z",constant:[]}],generateRange:function(e){for(var t=Math.max(0,Math.min(+e,999)),i=(!isNaN(t)&&(0|t)===t||(t=0),new Array(t)),n=0;n<t;n++)i[n]=n+1+"";return i},copyAnswer:function(){var e=(this.board.ublkmgr.enabled?this.board.ublkmgr:this.board.roommgr).components.map(function(e){return e.clist.length+""});return e.sort(function(e,t){return e-t}),e},highestPiece:0,rebuildExtraData:function(){for(var e=0,t=0;t<this.pieces.length;t++)e=Math.max(e,this.pieces[t].getNum());this.highestPiece=e}},BankPiece:{num:null,deserialize:function(e){if(+e)this.num=+e;else{if(e)throw new Error("Invalid piece: "+typeof e+" "+e);this.num=-1}},serialize:function(){return 0<this.num?this.num+"":null},getmaxnum:function(){return 999},getminnum:function(){return 1},getNum:function(){return this.num},setNum:function(e){this.board.bank.setPiece(e,this.index)},disInputHatena:!0,w:10,h:10},BankEditOperation:{isBankEdit:!0,disInputHatena:!0,isModify:function(e){return!(!e.isBankEdit||e.index!==this.index||null!==this.old&&null!==this.num&&+e.num!=+this.old)&&(e.num=this.num,!0)}},BankAddButton:{w:10,h:10,getmaxnum:function(){return 999},getminnum:function(){return 1},getNum:function(){return-1},setNum:function(e){e<0||this.board.bank.setPiece(e,this.index)}},Graphic:{bankratio:.1,bankVerticalOffset:.25,paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawTargetSubNumber(!0),this.drawBorders(),this.drawBorderQsubs(),this.drawSubNumbers(),this.drawQuesNumbers(),this.drawChassis(),this.drawBank(),this.drawTarget()},getNumberTextCore:function(e){return 0<e?""+e:-2===e?"?":""},drawBankPiece:function(e,t,i){if(!t)return e.vid="pb_c"+i,e.vhide(),e.vid="pb_n"+i,void e.vhide();var n=.1*this.cw*(t.x+5),r=.1*this.ch*t.y,i=(r+=(this.board.rows+.75)*this.ch,e.vid="pb_c"+i,e.strokeStyle=this.getBankPieceColor(t),e.fillStyle=null,e.shapeCircle(n,r,.4*this.cw),e.vid="pb_n"+i,e.strokeStyle=null,e.fillStyle=this.getBankPieceColor(t),0<=t.num?""+t.num:"");this.disptext(i,n,r,{ratio:.65})},drawTarget:function(){this.drawCursor(!0,this.puzzle.editmode||0<=this.puzzle.mouse.inputMode.indexOf("number"))},getBGCellColor:function(e){return 1===(e.error||e.qinfo)?this.errbcolor1:e.isEmpty()?"black":null},getBorderColor:function(e){return e.isQuesBorder()?"black":this.getBorderColor_qans(e)}},Encode:{decodePzpr:function(){var i=this.board;"/"!==this.outbstr[0]&&this.genericDecodeNumber16(i.cell.length,function(e,t){0===t?i.cell[e].ques=7:i.cell[e].qnum=t}),this.decodePieceBank()},encodePzpr:function(e){var t=this.board;this.genericEncodeNumber16(t.cell.length,function(e){return t.cell[e].isEmpty()?0:t.cell[e].qnum}),this.encodePieceBank()},decodePieceBank:function(){"="===this.outbstr[this.outbstr.length-1]&&(this.outbstr=this.outbstr.substring(0,this.outbstr.length-1));var e,t=+this.outbstr.substr(2);"//"!==this.outbstr.substr(0,2)||isNaN(t)?this.common.decodePieceBank.call(this):((e=this.board.bank).initialize(e.generateRange(t)),this.outbstr="")},encodePieceBank:function(){var e=this.board.bank,t=e.pieces.length,i=!1;if(0<t&&t<=999&&9!==t)for(var i=!0,n=0;n<t&&i;n++)e.pieces[n].num!==n+1&&(i=!1);i?this.outbstr+="//"+t:this.common.encodePieceBank.call(this)}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderAns(),this.decodePieceBank(),this.decodePieceBankQcmp(),this.decodeCellSnum()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderAns(),this.encodePieceBank(),this.encodePieceBankQcmp(),this.encodeCellSnum()},decodeCellQnum:function(){this.decodeCell(function(e,t){e.ques=0,"*"===t?e.ques=7:"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)})},encodeCellQnum:function(){this.encodeCell(function(e){return 7===e.ques?"* ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "})}},AnsCheck:{checklist:["checkSameNumberInBlock","checkBankPiecesAvailable","checkBankPiecesInvalid","checkBankPiecesUsed","checkBorderUnused","checkViewNumber","checkMaxViewNoNumber","checkMaxViewNotEqual"],getAllViews:function(){for(var e=this.board,t=e.roommgr.components,i=0;i<t.length;i++)t[i].id=i,t[i].maxView=0;for(var n=0;n<e.cell.length;n++){var r,s=e.cell[n];s.isEmpty()||(r=s.room.id,s.view=1,s.view+=s.getViewCells(r,0,-2),s.view+=s.getViewCells(r,0,2),s.view+=s.getViewCells(r,-2,0),s.view+=s.getViewCells(r,2,0),s.room.maxView<s.view&&(s.room.maxView=s.view))}},checkViewNumber:function(){this.getAllViews(),this.checkAllCell(function(e){return e.isNum()&&0<e.qnum&&e.qnum!==e.view},"viewNe")},checkMaxViewNoNumber:function(){this.getAllViews(),this.checkAllCell(function(e){return e.view===e.room.maxView&&e.noNum()},"maxViewNoNum")},checkMaxViewNotEqual:function(){this.getAllViews(),this.checkAllCell(function(e){return e.isNum()&&e.view!==e.room.maxView},"maxViewNe")},checkSameNumberInBlock:function(){this.checkSameObjectInRoom(this.board.roommgr,function(e){return e.getNum()<=0?-1:e.getNum()},"bkPlNum")},checkBorderUnused:function(){for(var e=this.board.border,t=0;t<e.length;t++){var i=e[t];if(!i.isnull&&i.qans){var n=i.sidecell[0].room,r=i.sidecell[1].room;if(!(n!==r||1<n.numcount)){if(this.failcode.add("bdUnused"),this.checkOnly)break;e.setnoerr(),i.seterr(1)}}}}},FailCode:{ceNoNum:"ceNoNum.lohkous",bkSizeLt:"bkSizeLt.fillomino",bdUnused:"bdUnused.lohkous"}});
//# sourceMappingURL=lookouts.js.map